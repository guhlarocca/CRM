{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/leads">Leads</a></li>
            <li class="breadcrumb-item active">Novo Lead</li>
        </ol>
    </nav>

    <h2 class="mb-4">Novo Lead</h2>

    <form method="POST" action="/leads/novo">
        <div class="row">
            <!-- Informações Básicas -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-user me-2"></i>Informações Básicas
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome Completo*</label>
                            <input type="text" class="form-control" id="nome" name="nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Principal*</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="telefone" class="form-label">Telefone Principal</label>
                            <input type="tel" class="form-control" id="telefone" name="telefone">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informações de Contato -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="fas fa-envelope me-2"></i>Informações de Contato
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="email_comercial" class="form-label">Email Comercial</label>
                            <input type="email" class="form-control" id="email_comercial" name="email_comercial">
                        </div>
                        <div class="mb-3">
                            <label for="email_comercial_02" class="form-label">Email Comercial 02</label>
                            <input type="email" class="form-control" id="email_comercial_02" name="email_comercial_02">
                        </div>
                        <div class="mb-3">
                            <label for="email_comercial_03" class="form-label">Email Comercial 03</label>
                            <input type="email" class="form-control" id="email_comercial_03" name="email_comercial_03">
                        </div>
                        <div class="mb-3">
                            <label for="email_financeiro" class="form-label">Email Financeiro</label>
                            <input type="email" class="form-control" id="email_financeiro" name="email_financeiro">
                        </div>
                        <div class="mb-3">
                            <label for="telefone_comercial" class="form-label">Telefone Comercial</label>
                            <input type="tel" class="form-control" id="telefone_comercial" name="telefone_comercial">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Localização e Empresa -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <i class="fas fa-map-marker-alt me-2"></i>Localização e Empresa
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="cidade" class="form-label">Cidade</label>
                            <input type="text" class="form-control" id="cidade" name="cidade">
                        </div>
                        <div class="mb-3">
                            <label for="estado" class="form-label">Estado</label>
                            <select class="form-select" id="estado" name="estado">
                                <option value="">Selecione o Estado</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="empresa" class="form-label">Empresa</label>
                            <input type="text" class="form-control" id="empresa" name="empresa">
                        </div>
                        <div class="mb-3">
                            <label for="cargo" class="form-label">Cargo</label>
                            <input type="text" class="form-control" id="cargo" name="cargo">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Contatos Adicionais -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-warning text-white">
                        <i class="fas fa-address-book me-2"></i>Contatos Adicionais
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="contato_01" class="form-label">Contato 01</label>
                            <input type="text" class="form-control" id="contato_01" name="contato_01">
                        </div>
                        <div class="mb-3">
                            <label for="contato_02" class="form-label">Contato 02</label>
                            <input type="text" class="form-control" id="contato_02" name="contato_02">
                        </div>
                        <div class="mb-3">
                            <label for="observacoes" class="form-label">Observações</label>
                            <textarea class="form-control" id="observacoes" name="observacoes" rows="4"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendedor e Status -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-chart-line me-2"></i>Vendedor e Status
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="vendedor_id" class="form-label">Vendedor Responsável</label>
                            <select class="form-select" id="vendedor_id" name="vendedor_id">
                                <option value="">Selecione um vendedor...</option>
                                {% for vendedor in vendedores %}
                                <option value="{{ vendedor.id }}">{{ vendedor.nome }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="estagio_atual" class="form-label">Estágio Atual</label>
                            <select class="form-select" id="estagio_atual" name="estagio_atual" required>
                                <option value="Não Iniciado">Não Iniciado</option>
                                <option value="Enviado Email">Enviado Email</option>
                                <option value="Sem retorno Email">Sem retorno Email</option>
                                <option value="Retorno Agendado">Retorno Agendado</option>
                                <option value="Linkedin">Linkedin</option>
                                <option value="Sem Retorno Linkedin">Sem Retorno Linkedin</option>
                                <option value="WhatsApp">WhatsApp</option>
                                <option value="Sem Retorno WhatsApp">Sem Retorno WhatsApp</option>
                                <option value="Email Despedida">Email Despedida</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="venda_fechada" name="venda_fechada">
                                <label class="form-check-label" for="venda_fechada">
                                    Venda Fechada
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save me-2"></i>Salvar Lead
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Máscara de telefone
    document.getElementById('telefone').addEventListener('input', function(e) {
        let telefone = e.target.value.replace(/\D/g, '');
        if (telefone.length > 11) telefone = telefone.slice(0, 11);
        
        if (telefone.length > 10) {
            // Celular
            telefone = telefone.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        } else if (telefone.length > 6) {
            // Telefone fixo
            telefone = telefone.replace(/^(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
        } else if (telefone.length > 2) {
            telefone = telefone.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
        }
        
        e.target.value = telefone;
    });

    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const nomeInput = document.getElementById('nome');
        const emailInput = document.getElementById('email');
        const vendedorInput = document.getElementById('vendedor_id');

        form.addEventListener('submit', function(event) {
            let hasErrors = false;
            let errorMessage = 'Por favor, corrija os seguintes erros:\n\n';

            // Validação do Nome
            if (!nomeInput.value.trim()) {
                errorMessage += '- O campo Nome é obrigatório.\n';
                hasErrors = true;
            }

            // Validação do Email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailInput.value.trim()) {
                errorMessage += '- O campo Email é obrigatório.\n';
                hasErrors = true;
            } else if (!emailRegex.test(emailInput.value)) {
                errorMessage += '- Por favor, insira um email válido.\n';
                hasErrors = true;
            }

            // Validação do Vendedor
            if (!vendedorInput.value) {
                errorMessage += '- Selecione um Vendedor Responsável.\n';
                hasErrors = true;
            }

            // Validações de emails adicionais (opcional)
            const emailsAdicionais = [
                'email_comercial', 
                'email_comercial_02', 
                'email_comercial_03', 
                'email_financeiro'
            ];

            emailsAdicionais.forEach(emailId => {
                const emailAdicionalInput = document.getElementById(emailId);
                if (emailAdicionalInput.value.trim()) {
                    if (!emailRegex.test(emailAdicionalInput.value)) {
                        errorMessage += `- O email ${emailId.replace('_', ' ')} não é válido.\n`;
                        hasErrors = true;
                    }
                }
            });

            // Se houver erros, previne o envio e mostra mensagem
            if (hasErrors) {
                event.preventDefault();
                alert(errorMessage);
            }
        });
    });
</script>
{% endblock %}
